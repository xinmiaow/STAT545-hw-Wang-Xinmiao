---
title: "STAT HW03"
author: "Xinmiao Wang"
date: "`r format(Sys.Date())`"
output: github_document
---

#Navigation 

* The main repo for homework: [here](https://github.com/xinmiaow/STAT545-hw-Wang-Xinmiao) 

* Requirement for Homework 03: click [here](http://stat545.com/hw03_dplyr-and-more-ggplot2.html)

* hw03 folder: [here](https://github.com/xinmiaow/STAT545-hw-Wang-Xinmiao/tree/master/hw03).

* Files inside hw03:

  1. [README.md](https://github.com/xinmiaow/STAT545-hw-Wang-Xinmiao/blob/master/hw03/README.md)
  2. [hw03_Gapminder.md](https://github.com/xinmiaow/STAT545-hw-Wang-Xinmiao/blob/master/hw03/hw03_Gapminder.md)

# Induction 

In this module, the main goal is to pracitce dplyr as our manipulation tool with ggplot2 as our visulization tool. We conitnue to explore Gapminder dataset. Those can be loaded from tidyverse package and gapminder package in R. Please make it sure that those package have been installed before we load them.

# Load Package

Install `gapminder` from CRAN:
```{r eval=FALSE}
install.packages("gapminder")
```

Install `tidyverse` from CRAN:
```{r eval=FALSE}
install.packages("tidyverse")
```

Here, we load packages that we gonna use later.

```{r load_library, warning=F}
#load packages
library(gapminder)
library(tidyverse)
library(ggthemes)
library(xtable)
```


# Get the maximum and minimum of GDP per capita for all continents

<table border = 1>
<tr>
<td>

```{r max_min, results='asis', echo=FALSE}
gapminder %>% 
  group_by(continent) %>% 
  summarise(Max=max(gdpPercap), Min=min(gdpPercap)) %>% 
  knitr::kable()
```
</td>
<td>
```{r gdpPerca_plot, results='asis', echo=FALSE}
ggplot(gapminder, aes(x=continent, y=gdpPercap, color = continent)) +
  geom_point()+ 
  theme_calc()+
  ggtitle("GDP per cap by continent")
```

</td>
</tr>
</table>



# Look at the spread of GDP per capita within the continents.

```{r density_gdp}
ggplot(gapminder, aes(x=gdpPercap, fill=continent))+
  geom_density(alpha = 0.2, lwd=0.65)+
  theme_calc()+
  ggtitle("The Density Plot of gdpPercap for each continents")

```


```{r spread_gpd}
gapminder %>% 
  group_by(continent) %>% 
  summarise(SD.gdp=sd(gdpPercap), IQR.gdp=IQR(gdpPercap)) %>% 
  knitr::kable()

ggplot(gapminder, aes(x=continent, y=gdpPercap, color=continent))+
  geom_boxplot(fill=continent_colors)+
  theme_calc()+
  ggtitle("The Boxplot of GDP per capita in each Continent")

```


# Compute a trimmed mean of life expectancy for different years. Or a weighted mean, weighting by population. 

```{r tim_mean_lifeExp}
gapminder %>% 
  group_by(year) %>%
  summarise(trimmed_mean=mean(lifeExp,trim=0.1)) %>% 
  knitr::kable()

gapminder %>% 
  group_by(year) %>% 
  summarise(trimmed_mean=mean(lifeExp,trim=0.1)) %>% 
  ggplot(aes(x=factor(year), y=trimmed_mean))+
  geom_point()+
  labs(x="year", y="Trimmed mean of lifeExp")+
  theme_calc()+
  ggtitle("The Plot of Trimmed Mean of LifeExp for each year")

```

```{r weighted_mean_lifeExp}
gapminder %>% 
  group_by(year) %>% 
  summarise(weighted_mean=weighted.mean(lifeExp, pop)) %>% 
  knitr::kable()

gapminder %>%
  group_by(year) %>%
  summarise(weighted_mean=weighted.mean(lifeExp, pop)) %>%
  ggplot(aes(x=factor(year), y=weighted_mean))+
  geom_point()+
  labs(x="year", y="Weighted mean of lifeExp")+
  theme_calc()+
  ggtitle("The Plot of Weighted Mean of LifeExp by population for each year")

```



# How is life expectancy changing over time on different continents?

```{r change_lifeExp}
gapminder %>% 
  group_by(country) %>%  
  mutate(diff.lifeExp=lifeExp-lag(lifeExp)) %>% 
  group_by(continent, year) %>% 
  summarise(Diff=mean(diff.lifeExp, na.rm = T)) %>% 
  knitr::kable()
  
ggplot(gapminder, aes(x=year, y=lifeExp, color=continent))+
  geom_point(aes(group=continent))+
  geom_smooth(se=FALSE)+
  facet_wrap(~continent)+
  theme_calc()+
  ggtitle("The plot of lifeExp over time in each Continent with trend")
  
```


```{r lag_lifeExp, eval=FALSE, echo=FALSE}
#lag
gapminder %>% 
  ggplot(aes(x=year, y=lifeExp, group=country))+
  geom_line(lwd=0.75, show.legend=FALSE)+
  aes(color = country)+ 
  scale_color_manual(values = country_colors)+
  facet_wrap(~continent)+
  theme_calc()+
  ggtitle("The plot of lifeExp over time in each Continent")

```

# Reference

* [ggplot2: Stat Summary](http://ggplot2.tidyverse.org/reference/stat_summary.html)

* [lotr-tidy: xtable](https://github.com/jennybc/lotr-tidy/blob/master/01-intro.Rmd)